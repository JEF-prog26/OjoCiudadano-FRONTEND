<app-header-panel-component/>
<div class="page-wrapper">
  <div class="panel-wrapper">
    <div class="panel-card">

      <!-- üîπ CABECERA CON T√çTULO, BOT√ìN Y BUSCADOR -->
      <div class="panel-header">
        <h2 class="panel-title">Panel de Gesti√≥n de Denuncias</h2>

        <div class="header-actions">
          <button class="action-btn action-primary" (click)="onRegistrarClick()">
            Registrar Denuncia
          </button>

          <div class="search-box">
            <input
              type="number"
              class="search-input"
              placeholder="Buscar por ID..."
              [(ngModel)]="searchId"
              />
              <button class="search-btn" (click)="buscarPorId()">Buscar</button>
              <button class="search-btn-secondary" (click)="limpiarBusqueda()">Limpiar</button>
            </div>
          </div>
        </div>

        <!-- üîπ CONTENIDO PRINCIPAL -->
        <section class="panel-main">

          <!-- LISTA / TABLA -->
          @if (!showForm) {
            <div class="table-card">
              <div class="table-header">
                <span>ID</span>
                <span>T√≠tulo</span>
                <span>Descripci√≥n</span>
                <span>Fecha Denuncia</span>
                <span>Estado</span>
                <span>Acciones</span>
              </div>
              <div class="table-body">
                @for (d of denunciasFiltradas; track d) {
                  <div class="table-row">
                    <span>{{ d.id }}</span>
                    <span>{{ d.titulo }}</span>
                    <span>{{ d.descripcion }}</span>
                    <span>{{ d.fechaDenuncia }}</span>
                    <span>{{ d.estado }}</span>
                    <span class="cell-actions">
                      <button class="icon-btn view" (click)="verDetalle(d)">üëÅ</button>
                      <button class="icon-btn edit" (click)="editarDenuncia(d)">‚úèÔ∏è</button>
                      <button class="icon-btn delete" (click)="eliminarDenuncia(d)">üóë</button>
                    </span>
                  </div>
                }
              </div>
              <div class="scrollbar-horizontal"></div>
              <div class="scrollbar-vertical"></div>
            </div>
          } @else {
            <div class="form-card">
              <h3>{{ editingId ? 'Editar denuncia' : 'Registrar nueva denuncia' }}</h3>
              <div class="form-row">
                <label class="form-label">ID</label>
                <input
                  class="form-input"
                  type="number"
                  [(ngModel)]="denunciaForm.id"
                  [readonly]="editingId !== null"
                  />
                </div>
                <div class="form-row">
                  <label class="form-label">T√≠tulo</label>
                  <input class="form-input" type="text" [(ngModel)]="denunciaForm.titulo" />
                </div>
                <div class="form-row">
                  <label class="form-label">Descripci√≥n</label>
                  <textarea
                    class="form-input"
                    rows="3"
                    [(ngModel)]="denunciaForm.descripcion">
                  </textarea>
                </div>
                <div class="form-row">
                  <label class="form-label">Fecha de Denuncia</label>
                  <input class="form-input" type="date" [(ngModel)]="denunciaForm.fechaDenuncia" />
                </div>
                <div class="form-row">
                  <label class="form-label">Estado</label>
                  <input class="form-input" type="text" [(ngModel)]="denunciaForm.estado" />
                </div>
                <div class="form-actions">
                  <button class="form-btn-secondary" (click)="cancelarForm()">Cancelar</button>
                  <button class="form-btn-primary" (click)="guardarDenuncia()">
                    {{ editingId ? 'Guardar cambios' : 'Registrar' }}
                  </button>
                </div>
              </div>
            }

            <!-- FORMULARIO (CREAR / EDITAR) -->

            <!-- üß© MODAL DETALLE + TIMELINE -->
            <!-- üåü MODAL DETALLE + TIMELINE (versi√≥n est√©tica) -->
            @if (detailOpen) {
              <div class="modal-backdrop" (click)="cerrarDetalle()">
                <section
                  class="modal-card pretty"
                  role="dialog"
                  aria-modal="true"
                  aria-labelledby="detalleTitle"
                  (click)="$event.stopPropagation()"
                  >
                  <header class="modal-header pretty">
                    <div class="title-wrap">
                      <div class="title-icon">üóÇÔ∏è</div>
                      <div>
                        <h3 id="detalleTitle" class="modal-title">Denuncia #{{ detalleSeleccionado?.id }}</h3>
                        <p class="modal-subtitle">{{ detalleSeleccionado?.titulo || '‚Äî' }}</p>
                      </div>
                    </div>
                    <button class="modal-close" (click)="cerrarDetalle()" aria-label="Cerrar">‚úñ</button>
                  </header>
                  <div class="modal-body">
                    <!-- Detalles -->
                    <div class="detail-section card">
                      <h4 class="section-title">Detalles generales</h4>
                      <div class="meta-grid">
                        <div class="meta">
                          <span class="meta-label">ID</span>
                          <span class="meta-value mono">#{{ detalleSeleccionado?.id }}</span>
                        </div>
                        <div class="meta">
                          <span class="meta-label">Fecha de denuncia</span>
                          <span class="meta-value">{{ detalleSeleccionado?.fechaDenuncia || '‚Äî' }}</span>
                        </div>
                        <div class="meta full">
                          <span class="meta-label">Descripci√≥n</span>
                          <p class="meta-value multiline">{{ detalleSeleccionado?.descripcion || '‚Äî' }}</p>
                        </div>
                        <div class="meta">
                          <span class="meta-label">Estado actual</span>
                          <span class="badge big" [ngClass]="estadoClass(detalleSeleccionado?.estado)">
                            {{ detalleSeleccionado?.estado || '‚Äî' }}
                          </span>
                        </div>
                      </div>
                    </div>
                    <div class="divider"></div>
                    <!-- Timeline -->
                    <div class="detail-section card">
                      <h4 class="section-title">Seguimiento</h4>
                      <ul class="timeline pretty">
                        @for (h of detalleSeleccionado?.historial; track h) {
                          <li class="timeline-item">
                            <div class="timeline-dot" [ngClass]="estadoClass(h.estado)"></div>
                            <div class="timeline-content">
                              <div class="timeline-head">
                                <span class="timeline-state" [ngClass]="estadoClass(h.estado)">{{ h.estado }}</span>
                                <span class="timeline-date">{{ h.fecha }}</span>
                              </div>
                              <p class="timeline-desc">{{ h.descripcion || '‚Äî' }}</p>
                            </div>
                          </li>
                        }
                        @if (!detalleSeleccionado?.historial?.length) {
                          <li class="timeline-empty">
                            A√∫n no hay eventos registrados.
                          </li>
                        }
                      </ul>
                    </div>
                  </div>
                </section>
              </div>
            }




          </section>
        </div>
      </div>

      <footer class="bottom-bar"></footer>
    </div>
