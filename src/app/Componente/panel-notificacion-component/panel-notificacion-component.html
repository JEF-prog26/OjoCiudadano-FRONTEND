<header class="top-bar">
  <button class="back-button" (click)="goBack()">
    &lt; Volver a la p√°gina anterior
  </button>
</header>
<div class="page-wrapper">
  <div class="panel-wrapper">
    <div class="panel-card">

      <div class="panel-header">
        <h2 class="panel-title">Panel de Gesti√≥n de Notificaciones</h2>

        <div class="header-actions">
          <button class="action-btn action-primary" (click)="onRegistrarClick()">
            Crear Notificaci√≥n
          </button>

          <div class="search-box">
            <input
              type="number"
              class="search-input"
              placeholder="Buscar por ID..."
              [(ngModel)]="searchId"
            />
            <button class="search-btn" (click)="buscarPorId()">Buscar</button>
            <button class="search-btn-secondary" (click)="limpiarBusqueda()">Limpiar</button>
          </div>
        </div>
      </div>

      <section class="panel-main">

        <ng-container *ngIf="!showForm; else formularioRegistro">
          <div class="table-card">

            <div class="table-header table-notification-grid">
              <span>ID</span>
              <span>Mensaje</span>
              <span>Fecha</span>
              <span>Tipo</span>
              <span>Estado</span>
              <span>Acciones</span>
            </div>

            <div class="table-body">
              <div class="table-row table-notification-grid" *ngFor="let n of notificacionesFiltradas">
                <span>{{ n.id }}</span>
                <span [class.unread]="!n.leida" class="message-cell">{{ n.mensaje }}</span>
                <span>{{ n.fecha | date: 'shortDate' }}</span>
                <span [ngClass]="tipoClass(n.tipo)">{{ n.tipo }}</span>
                <span class="status-cell">
                    <span class="badge" [ngClass]="n.leida ? 'status-leida' : 'status-pendiente'">
                        {{ n.leida ? 'Le√≠da' : 'Pendiente' }}
                    </span>
                </span>
                <span class="cell-actions">
                  <button class="icon-btn view" (click)="verDetalle(n)" title="Ver Detalle">üëÅ</button>

                  <button
                    *ngIf="!n.leida"
                    class="icon-btn mark-read"
                    (click)="marcarComoLeida(n)"
                    title="Marcar como Le√≠da"
                  >‚úì</button>

                  <button class="icon-btn delete" (click)="eliminarNotificacion(n)" title="Eliminar">üóë</button>
                </span>
              </div>
            </div>

            <div class="scrollbar-horizontal"></div>
            <div class="scrollbar-vertical"></div>
          </div>
        </ng-container>

        <ng-template #formularioRegistro>
          <div class="form-card">
            <h3>{{ editingId ? 'Editar notificaci√≥n' : 'Registrar nueva notificaci√≥n' }}</h3>

            <div class="form-row">
              <label class="form-label">ID</label>
              <input
                class="form-input"
                type="number"
                [(ngModel)]="notificacionForm.id"
                [readonly]="editingId !== null"
              />
            </div>

            <div class="form-row">
              <label class="form-label">Mensaje</label>
              <textarea
                class="form-input"
                rows="3"
                [(ngModel)]="notificacionForm.mensaje">
              </textarea>
            </div>

            <div class="form-row">
              <label class="form-label">Tipo (EJ: Alerta, Info, Sistema)</label>
              <input class="form-input" type="text" [(ngModel)]="notificacionForm.tipo" />
            </div>

            <div class="form-row">
              <label class="form-label">¬øEst√° Le√≠da?</label>
              <input type="checkbox" [(ngModel)]="notificacionForm.leida" />
            </div>

            <div class="form-actions">
              <button class="form-btn-secondary" (click)="cancelarForm()">Cancelar</button>
              <button class="form-btn-primary" (click)="guardarNotificacion()">
                {{ editingId ? 'Guardar cambios' : 'Registrar' }}
              </button>
            </div>
          </div>
        </ng-template>

        <div class="modal-backdrop" *ngIf="detailOpen" (click)="cerrarDetalle()">
          <section
            class="modal-card pretty"
            role="dialog"
            aria-modal="true"
            aria-labelledby="detalleTitle"
            (click)="$event.stopPropagation()"
          >
            <header class="modal-header pretty">
              <div class="title-wrap">
                <div class="title-icon">üîî</div>
                <div>
                  <h3 id="detalleTitle" class="modal-title">Notificaci√≥n #{{ detalleSeleccionado?.id }}</h3>
                  <p class="modal-subtitle">{{ detalleSeleccionado?.tipo || '‚Äî' }}</p>
                </div>
              </div>
              <button class="modal-close" (click)="cerrarDetalle()" aria-label="Cerrar">‚úñ</button>
            </header>

            <div class="modal-body">
              <div class="detail-section card">
                <h4 class="section-title">Detalles de la Notificaci√≥n</h4>

                <div class="meta-grid">
                  <div class="meta">
                    <span class="meta-label">ID</span>
                    <span class="meta-value mono">#{{ detalleSeleccionado?.id }}</span>
                  </div>

                  <div class="meta">
                    <span class="meta-label">Fecha de Env√≠o</span>
                    <span class="meta-value">{{ detalleSeleccionado?.fecha | date: 'medium' }}</span>
                  </div>

                  <div class="meta">
                    <span class="meta-label">Tipo</span>
                    <span class="meta-value" [ngClass]="tipoClass(detalleSeleccionado?.tipo)">
                        {{ detalleSeleccionado?.tipo || '‚Äî' }}
                    </span>
                  </div>

                  <div class="meta">
                    <span class="meta-label">Estado</span>
                    <span class="badge big" [ngClass]="detalleSeleccionado?.leida ? 'status-leida' : 'status-pendiente'">
                        {{ detalleSeleccionado?.leida ? 'Le√≠da' : 'Pendiente' }}
                    </span>
                  </div>

                  <div class="meta full">
                    <span class="meta-label">Mensaje</span>
                    <p class="meta-value multiline">{{ detalleSeleccionado?.mensaje || '‚Äî' }}</p>
                  </div>
                </div>
              </div>
            </div>

          </section>
        </div>
      </section>
    </div>
  </div>

  <footer class="bottom-bar"></footer>
</div>
